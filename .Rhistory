acs_long[[i]]$year<-years[i]
}
acs_long<-do.call(smartbind, acs_long)
acs_long<-acs_long[acs_long$geoid!="Id",]
acs_long<-acs_long[,c("geoid", "state_fips", "state_name", "year",
"tot_pop", "foreign_pop",
"non_citizen_pop", "pct_blk",
"pct_hisp", "pct_foreign_hisp",
"pct_noncitizen_hisp")]
###BLS###
apiDF <- function(data){
df <- data.frame(year=character(),
period=character(),
periodName=character(),
value=character(),
stringsAsFactors=FALSE)
i <- 0
for(d in data){
i <- i + 1
df[i,] <- unlist(d)
}
return(df)
}
for(c in 1:length(bls_codes$code)){
df<-apiDF(bls_files$Results$series[[c]]$data)
df$state<-paste0(as.character(bls_codes$state[c]))
assign(paste0(bls_codes$state[c], "_unemp"), df)
}
rm('_unemp')
bls_names<-ls(pattern="*_unemp")
bls_long<-ldply(bls_names, get)
bls_long<-bls_long[bls_long$periodName=="Annual",]
bls_long<-bls_long[,c("state", "year", "value")]
names(bls_long)<-c("state_name", "year", "unemp_rate")
rm(list=ls(pattern="_unemp"))
bls_long<-arrange(bls_long, state, year)
###FEDERAL ELECTIONS###
fed_elections_long<-do.call(smartbind, fed_files)
fed_elections_long[, c("dem_fedvotes", "rep_fedvotes", "oth_fedvotes")]<-sapply(fed_elections_long[, c("dem_fedvotes", "rep_fedvotes", "oth_fedvotes")], function(x){
as.numeric(gsub(",","", x))
})
not_states<-c("AS", "GU", "PR", "MP", "VI", "DC")
fed_elections_long<-data.frame(fed_elections_long)%>%
mutate(pct_fedvotes_dem=((dem_fedvotes/(dem_fedvotes+rep_fedvotes+oth_fedvotes))*100),
pct_fedvotes_rep=((rep_fedvotes/(dem_fedvotes+rep_fedvotes+oth_fedvotes))*100))%>%
select(state_abb=state, year, pct_fedvotes_dem, pct_fedvotes_rep, dem_fedvotes, rep_fedvotes)
fed_elections_long<- fed_elections_long[(fed_elections_long$state_abb %in% not_states==F),]
###GUBERNATORIAL ELECTIONS###
gov_elections_long<-do.call(smartbind, gov_elections_files)
gsub()
###GUBERNATORIAL PARTY AFFILIATION###
for (i in seq(years)){
gov_party_files[[i]]$year<-years[i]
}
gov_party_long<-do.call(smartbind, gov_party_files)
#######################
###MISSING VARIABLES###
#######################
state_legs[27,2:153]<-NA
bls_long<-arrange(bls_long, state_name, year)
names(everify_long[1])
names(everify_long[1])<-"state_abb"
View(everify_long)
names(everify_long)[names(everify_long) == 'state'] <- 'state_abb'
acs_long$pct_foreign<- (acs_long$foreign_pop/acs_long$tot_pop)*100
acs_long$pct_non_citizen<- (acs_long$non_citizen_pop/acs_long$tot_pop)*100
acs_long$pct_foreign<- (as.numeric(acs_long$foreign_pop)/as.numeric(acs_long$tot_pop))*100
acs_long$pct_non_citizen<- (as.numeric(acs_long$non_citizen_pop)/as.numeric(acs_long$tot_pop))*100
View(state_legs)
state_legs_wide<-state_legs
View(acs_long)
length(unique(acs_long))
length(unique(acs_long$state_fips))
length(unique(acs_long$state_name))
unique(acs_long$state_fips)
unique(acs_long$state_names)
unique(acs_long$state_name)
not_states_name<-c("Puerto Rico", "District of Columbia")
acs_long<- acs_long[(acs_long$state_name %in% not_states_name==F),]
View(acs_long)
gov_party_long$rep_gov[gov_party_long$party=="R"]<-1
gov_party_long$rep_gov[gov_party_long$party!="R"]<-0
state_legs_long<-reshape(state_legs_wide,
dir = "long",
varying=list(names(everify_wide)[2:153]),
v.names=c("dems_lh", "rep_lh", "oth_lh", "vac_lh",
"dems_uh", "rep_uh", "oth_uh", "vac_uh")
idvar = c("state"),
timevar= "year",
times=c(1990:2014),
new.row.names = (1:1250))
state_legs_long<-reshape(state_legs_wide,
dir = "long",
varying=list(names(everify_wide)[2:153]),
v.names=c("dems_lh", "rep_lh", "oth_lh", "vac_lh",
"dems_uh", "rep_uh", "oth_uh", "vac_uh"),
idvar = c("state"),
timevar= "year",
times=c(1990:2014),
new.row.names = (1:1250))
state_legs_long<-reshape(state_legs_wide,
dir = "long",
varying=list(names(everify_wide)[2:153]),
v.names=c("dems_lh", "rep_lh", "oth_lh", "vac_lh",
"dems_uh", "rep_uh", "oth_uh", "vac_uh"),
idvar = c("state"),
timevar= "year",
times=c(1990, 1992, 1994, 1996, 1998, 2000,
2001, 2002, 2003, 2005, 2006, 2007, 2008,
2009, 2010, 2011, 2012, 2013, 2014),
new.row.names = (1:1250))
View(gov_party_long)
View(state_legs)
names(state_legs)
library(reshape2)
state_legs_long<-reshape(state_legs_wide,
dir = "long",
varying=list(names(everify_wide)[2:153]),
v.names=c("dems_lh", "rep_lh", "oth_lh", "vac_lh",
"dems_uh", "rep_uh", "oth_uh", "vac_uh"),
idvar = c("state"),
timevar= "year",
times=c(90, 92, 94, 96, 98, 00,
01, 02, 03, 2005, 2006, 2007, 2008,
2009, 2010, 2011, 2012, 2013, 2014),
new.row.names = (1:1250))
state_legs_long<-reshape(state_legs_wide,
dir = "long",
varying=list(names(everify_wide)[2:153]),
v.names=c("dems_lh", "rep_lh", "oth_lh", "vac_lh",
"dems_uh", "rep_uh", "oth_uh", "vac_uh"),
idvar = c("state"),
timevar= "year",
times=c(90, 92, 94, 96, 98, 00,
01, 02, 03, 05, 06, 07, 08,
09, 10, 11, 12, 13, 14),
new.row.names = (1:1250))
state_legs_long<-reshape(state_legs_wide,
dir = "long",
varying=list(names(everify_wide)[2:153]),
v.names=c("dems_lh", "rep_lh", "oth_lh", "vac_lh",
"dems_uh", "rep_uh", "oth_uh", "vac_uh"),
idvar = c("state"),
timevar= "year",
times=c("_90", "_92", "_94", "_96", "_98", "_00",
"_01", "_02", "_03", "_05", "_06", "_07", "_08",
"_09", "_10", "_11", "_12", "_13", "_14"),
new.row.names = (1:1250))
state_legs_long<-reshape(state_legs_wide,
dir = "long",
varying=list(names(everify_wide)[2:153]),
v.names=c("dems_lh", "rep_lh", "oth_lh", "vac_lh",
"dems_uh", "rep_uh", "oth_uh", "vac_uh"),
idvar = c("state"),
timevar= "year",
times=c("_90", "_92", "_94", "_96", "_98", "_00",
"_01", "_02", "_03", "_05", "_06", "_07", "_08",
"_09", "_10", "_11", "_12", "_13", "_14", "_90", "_92", "_94", "_96", "_98", "_00",
"_01", "_02", "_03", "_05", "_06", "_07", "_08",
"_09", "_10", "_11", "_12", "_13", "_14"),
new.row.names = (1:1250))
state_legs[27,2:153]<-NA
state_legs_wide<-state_legs
state_legs_long<-reshape(state_legs_wide,
dir = "long",
varying=list(names(everify_wide)[2:153]),
v.names=c("dems_lh", "rep_lh", "oth_lh", "vac_lh",
"dems_uh", "rep_uh", "oth_uh", "vac_uh"),
idvar = c("state"),
timevar= "year",
times=c("_90", "_92", "_94", "_96", "_98", "_00",
"_01", "_02", "_03", "_05", "_06", "_07", "_08",
"_09", "_10", "_11", "_12", "_13", "_14", "_90", "_92", "_94", "_96", "_98", "_00",
"_01", "_02", "_03", "_05", "_06", "_07", "_08",
"_09", "_10", "_11", "_12", "_13", "_14", "_90", "_92", "_94", "_96", "_98", "_00",
"_01", "_02", "_03", "_05", "_06", "_07", "_08",
"_09", "_10", "_11", "_12", "_13", "_14", "_90", "_92", "_94", "_96", "_98", "_00",
"_01", "_02", "_03", "_05", "_06", "_07", "_08",
"_09", "_10", "_11", "_12", "_13", "_14", "_90", "_92", "_94", "_96", "_98", "_00",
"_01", "_02", "_03", "_05", "_06", "_07", "_08",
"_09", "_10", "_11", "_12", "_13", "_14", "_90", "_92", "_94", "_96", "_98", "_00",
"_01", "_02", "_03", "_05", "_06", "_07", "_08",
"_09", "_10", "_11", "_12", "_13", "_14", "_90", "_92", "_94", "_96", "_98", "_00",
"_01", "_02", "_03", "_05", "_06", "_07", "_08",
"_09", "_10", "_11", "_12", "_13", "_14", "_90", "_92", "_94", "_96", "_98", "_00",
"_01", "_02", "_03", "_05", "_06", "_07", "_08",
"_09", "_10", "_11", "_12", "_13", "_14"),
new.row.names = (1:1250))
times=c(1990, 1992, 1994, 1996, 1998, 2000,
2001, 2002, 2003, 2005, 2006, 2007, 2008,
2009, 2010, 2011, 2012, 2013, 2014),
new.row.names = (1:1250))
state_legs_long<-reshape(state_legs_wide,
dir = "long",
varying=list(names(everify_wide)[2:153]),
v.names=c("dems_lh", "rep_lh", "oth_lh", "vac_lh",
"dems_uh", "rep_uh", "oth_uh", "vac_uh"),
idvar = c("state"),
timevar= "year",
times=c("_90", "_92", "_94", "_96", "_98", "_00",
"_01", "_02", "_03", "_05", "_06", "_07", "_08",
"_09", "_10", "_11", "_12", "_13", "_14", "_90", "_92", "_94", "_96", "_98", "_00",
"_01", "_02", "_03", "_05", "_06", "_07", "_08",
"_09", "_10", "_11", "_12", "_13", "_14", "_90", "_92", "_94", "_96", "_98", "_00",
"_01", "_02", "_03", "_05", "_06", "_07", "_08",
"_09", "_10", "_11", "_12", "_13", "_14", "_90", "_92", "_94", "_96", "_98", "_00",
"_01", "_02", "_03", "_05", "_06", "_07", "_08",
"_09", "_10", "_11", "_12", "_13", "_14", "_90", "_92", "_94", "_96", "_98", "_00",
"_01", "_02", "_03", "_05", "_06", "_07", "_08",
"_09", "_10", "_11", "_12", "_13", "_14", "_90", "_92", "_94", "_96", "_98", "_00",
"_01", "_02", "_03", "_05", "_06", "_07", "_08",
"_09", "_10", "_11", "_12", "_13", "_14", "_90", "_92", "_94", "_96", "_98", "_00",
"_01", "_02", "_03", "_05", "_06", "_07", "_08",
"_09", "_10", "_11", "_12", "_13", "_14", "_90", "_92", "_94", "_96", "_98", "_00",
"_01", "_02", "_03", "_05", "_06", "_07", "_08",
"_09", "_10", "_11", "_12", "_13", "_14"),
new.row.names = (1:1250))
state_legs_melt <- melt(state_legs_wide,id="state",variable_name="symbol")
View(state_legs_melt)
state_legs_melt <- data.frame(do.call('rbind', strsplit(as.character(state_legs_melt$variable),'h_',fixed=TRUE)))
View(state_legs_melt)
state_legs[27,2:153]<-NA
state_legs_wide<-state_legs
state_legs_melt <- melt(state_legs_wide,id="state",variable_name="symbol")
state_legs_melt$year<-substr(state_legs$variable, 1, 8)
state_legs_melt$year<-substr(state_legs$variable, 1, 7)
state_legs_melt$year<-substr(state_legs$variable, 7, 1)
substr
?substr
substr(state_legs$variable, 7, 1)
state_legs_melt$year<-substr(state_legs_melt$variable, 1, 2)
state_legs_melt$year<-substr(state_legs_melt$variable, 7, 2)
state_legs_melt$year<-substr(state_legs_melt$variable, 8, 10)
state_legs_melt$year<-substr(state_legs_melt$variable, 9, 10)
state_legs_melt$variable<-substr(state_legs_melt$variable, 1, 7)
?spread
state_legs_long<-state_legs_melt%>%
spread(variable, value)
state_legs_melt$row<-1:nrow(state_legs_melt)
state_legs_long<-state_legs_melt%>%
spread(variable, value)
View(state_legs_long)
state_legs_melt$id<- paste(state_legs_melt$state, state_legs_melt$year)
state_legs_melt$row<-NULL
state_legs_long<-state_legs_melt%>%
spread(variable, value)
state_legs_melt$id<- paste(state_legs_melt$state, state_legs_melt$year, state_legs_melt$variable)
state_legs_long<-state_legs_melt%>%
spread(variable, value)
?dcast
names(state_legs[-1])
state_legs_long<-state_legs_wide%>%
gather(party_house, members, dems_lh_90:vac_uh_14) %>%
mutate(year=substr(party_house, 9, 10),
party_house = substr(party_house, 1, 7)) %>%
spread(party_house, members) %>%
arrange(state, year)
state_legs_long<-state_legs_wide%>%
gather(party_house, members, dems_lh_90:vac_uh_14) %>%
mutate(year=substr(party_house, 9, 10),
party_house = substr(party_house, 1, 7),
row_name=1:nrow(.)) %>%
spread(party_house, members) %>%
arrange(state, year)
View(state_legs_long)
View(state_legs)
?transform
?seperate
??seperate
state_legs_long<-state_legs_wide%>%
gather(party_house, members, dems_lh_90:vac_uh_14) %>%
seperate(party_house, c("party_house", "year"), sep="h_")
?gather
state_legs_long<-state_legs_wide%>%
gather(party_house, members, dems_lh_90:vac_uh_14) %>%
seperate_(party_house, c("party_house", "year"), sep="h_")%>$
mutate(year=substr(party_house, 9, 10),
party_house = substr(party_house, 1, 7),
row_name=1:nrow(.)) %>%
spread(party_house, members) %>%
arrange(state, year)
state_legs_long<-state_legs_wide%>%
gather(party_house, members, dems_lh_90:vac_uh_14) %>%
seperate_(party_house, c("party_house", "year"), sep="h_")
library(tidyr)
state_legs_long<-state_legs_wide%>%
gather(party_house, members, dems_lh_90:vac_uh_14) %>%
seperate_(party_house, c("party_house", "year"), sep="h_")
?seperate
??seperate
state_legs_long<-state_legs_wide%>%
gather(party_house, members, dems_lh_90:vac_uh_14) %>%
separate(party_house, c("party_house", "year"), sep="h_")
state_legs_long<-state_legs_wide%>%
gather(party_house, members, dems_lh_90:vac_uh_14)
state_legs_long<-state_legs_wide%>%
gather(party_house, members, dems_lh_90:vac_uh_14) %>%
separate(as.character(party_house), c("party_house", "year"), sep="h_")
state_legs_long<-state_legs_wide%>%
gather(party_house, members, dems_lh_90:vac_uh_14) %>%
mutate(party_house=as.charcter(party_house)%>%
separate(party_house, c("party_house", "year"), sep="h_")
)
state_legs_long<-state_legs_wide%>%
gather(party_house, members, dems_lh_90:vac_uh_14) %>%
mutate(party_house=as.character(party_house))%>%
separate(party_house, c("party_house", "year"), sep="h_")
state_legs_long<-state_legs_wide%>%
gather(party_house, members, dems_lh_90:vac_uh_14) %>%
mutate(party_house=as.character(party_house))
?separate
state_legs_long<-state_legs_wide%>%
gather(party_house, members, dems_lh_90:vac_uh_14) %>%
mutate(party_house=as.character(party_house))%>%
separate(party_house, c("party_house", "year"), sep="h_", extra = "merge")
View(state_legs_long)
state_legs_long<-state_legs_wide%>%
gather(party_house, members, dems_lh_90:vac_uh_14) %>%
separate(party_house, c("party_house", "year"), sep="h_", extra = "merge")%>%
spread(party_house, members) %>%
arrange(state, year)
View(state_legs_long)
names(state_legs)<- gsub("oth", "other", names(state_legs))
names(state_legs)<- gsub("h_", "h.", names(state_legs))
state_legs_wide<-state_legs
state_legs_long<-state_legs_wide%>%
gather(party_house, members, dems_lh_90:vac_uh_14) %>%
separate(party_house, c("party_house", "year"), sep=".", extra = "merge")%>%
spread(party_house, members) %>%
arrange(state, year)
state_legs_long<-state_legs_wide%>%
gather(party_house, members, dems_lh.90:vac_uh.14) %>%
separate(party_house, c("party_house", "year"), sep=".", extra = "merge")%>%
spread(party_house, members) %>%
arrange(state, year)
state_legs_long<-state_legs_wide%>%
gather(party_house, members, dems_lh.90:vac_uh.14) %>%
separate(party_house, c("party_house", "year"), sep=".", extra = "merge")%>%
spread(party_house, members) %>%
arrange(state, year)
state_legs_wide<-state_legs
state_legs_long<-state_legs_wide%>%
gather(party_house, members, dems_lh.90:vac_uh.14) %>%
separate(party_house, c("party_house", "year"), sep=".", extra = "merge")%>%
spread(party_house, members) %>%
arrange(state, year)
state_legs_long<-state_legs_wide%>%
gather(party_house, members, dems_lh.90:vac_uh.14)
state_legs_long<-state_legs_wide%>%
gather(party_house, members, dems_lh.90:vac_uh.14) %>%
separate(party_house, c("party_house", "year"), sep=".", extra = "merge")
state_legs_long<-state_legs_wide%>%
gather(party_house, members, dems_lh.90:vac_uh.14) %>%
separate(party_house, c("party_house", "year"), sep=".", extra = "merge")%>%
spread(party_house, members)
View(state_legs_long)
state_legs_long<-state_legs_wide%>%
gather(party_house, members, dems_lh.90:vac_uh.14) %>%
separate(party_house, c("party_house", "year"), sep=".")
state_legs_long<-state_legs_wide%>%
gather(party_house, members, dems_lh.90:vac_uh.14) %>%
separate(party_house, c("party_house", "year"), sep=".", extra = "merge")
state_legs_long<-state_legs_wide%>%
gather(party_house, members, dems_lh.90:vac_uh.14) %>%
separate(party_house, c("party_house", "year"), sep="h.", extra = "merge")
state_legs[27,2:153]<-NA
names(state_legs)<- gsub("oth", "other", names(state_legs))
names(state_legs)<- gsub("h_", "hh.", names(state_legs))
state_legs_wide<-state_legs
state_legs_long<-state_legs_wide%>%
gather(party_house, members, dems_lh.90:vac_uh.14) %>%
separate(party_house, c("party_house", "year"), sep="h.", extra = "merge")%>%
spread(party_house, members) %>%
arrange(state, year)
View(state_legs_long)
state_legs[27,2:153]<-NA
names(state_legs)<- gsub("oth", "other", names(state_legs))
names(state_legs)<- gsub("h_", "hh.", names(state_legs))
state_legs_wide<-state_legs
source("scripts/load_packages.R")
load("data/loaded_dfs.Rdata")
state_legs[27,2:153]<-NA
names(state_legs)<- gsub("oth", "other", names(state_legs))
names(state_legs)<- gsub("h_", "h.", names(state_legs))
state_legs_wide<-state_legs
state_legs_long<-state_legs_wide%>%
gather(party_house, members, dems_lh.90:vac_uh.14) %>%
separate(party_house, c("party_house", "year"), sep=".", extra = "merge")%>%
spread(party_house, members) %>%
arrange(state, year)
state_legs_long<-state_legs_wide%>%
gather(party_house, members, dems_lh.90:vac_uh.14) %>%
separate(party_house, c("party_house", "year"), sep=".", extra = "merge")
source("scripts/load_packages.R")
load("data/loaded_dfs.Rdata")
state_legs[27,2:153]<-NA
names(state_legs)<- gsub("oth", "other", names(state_legs))
names(state_legs)<- gsub("h_", "z", names(state_legs))
state_legs_wide<-state_legs
state_legs_long<-state_legs_wide%>%
gather(party_house, members, dems_lh.90:vac_uh.14) %>%
separate(party_house, c("party_house", "year"), sep="z", extra = "merge")%>%
spread(party_house, members) %>%
arrange(state, year)
state_legs_long<-state_legs_wide%>%
gather(party_house, members, dems_lhz90:vac_uhz14) %>%
separate(party_house, c("party_house", "year"), sep="z", extra = "merge")%>%
spread(party_house, members) %>%
arrange(state, year)
###SOURCE AND LOAD###
source("scripts/load_packages.R")
load("data/loaded_dfs.Rdata")
state_legs[27,2:153]<-NA
names(state_legs)<- gsub("oth", "other", names(state_legs))
names(state_legs)<- gsub("h_", "hz", names(state_legs))
state_legs_wide<-state_legs
state_legs_long<-state_legs_wide%>%
gather(party_house, members, dems_lhz90:vac_uhz14) %>%
separate(party_house, c("party_house", "year"), sep="z", extra = "merge")%>%
spread(party_house, members) %>%
arrange(state, year)
View(state_legs_long)
state_legs_long$year[as.numeric(state_legs_long$year)<90]<-paste("19",state_legs_long$year)
state_legs_long<-state_legs_wide%>%
gather(party_house, members, dems_lhz90:vac_uhz14) %>%
separate(party_house, c("party_house", "year"), sep="z", extra = "merge")%>%
spread(party_house, members) %>%
arrange(state, year)
state_legs_long$year[as.numeric(state_legs_long$year)<90]<-paste("19",state_legs_long$yearstate_legs_long$year[as.numeric(state_legs_long$year)<90])
state_legs_long<-state_legs_wide%>%
gather(party_house, members, dems_lhz90:vac_uhz14) %>%
separate(party_house, c("party_house", "year"), sep="z", extra = "merge")%>%
spread(party_house, members) %>%
arrange(state, year)
state_legs_long$year[as.numeric(state_legs_long$year)<90]<-paste0("19",state_legs_long$yearstate_legs_long$year[as.numeric(state_legs_long$year)<90])
View(state_legs_long)
?paste
state_legs_long<-state_legs_wide%>%
gather(party_house, members, dems_lhz90:vac_uhz14) %>%
separate(party_house, c("party_house", "year"), sep="z", extra = "merge")%>%
spread(party_house, members) %>%
arrange(state, year)
state_legs_long$year[as.numeric(state_legs_long$year)<90]<-paste0("19",as.character(state_legs_long$yearstate_legs_long$year[as.numeric(state_legs_long$year)<90]), sep="")
state_legs_long<-state_legs_wide%>%
gather(party_house, members, dems_lhz90:vac_uhz14) %>%
separate(party_house, c("party_house", "year"), sep="z", extra = "merge")%>%
spread(party_house, members) %>%
arrange(state, year)
state_legs_long$year[as.numeric(state_legs_long$year)<90]<-paste0("19",as.character(state_legs_long$year[as.numeric(state_legs_long$year)<90==T]), sep="")
state_legs_long$year[as.numeric(state_legs_long$year)<90]<-paste0("19",as.character(state_legs_long$year[as.numeric(state_legs_long$year)<90]), sep="")
state_legs_long<-state_legs_wide%>%
gather(party_house, members, dems_lhz90:vac_uhz14) %>%
separate(party_house, c("party_house", "year"), sep="z", extra = "merge")%>%
spread(party_house, members) %>%
arrange(state, year)
state_legs_long$year[as.numeric(state_legs_long$year)<90]<-paste0("20",as.character(state_legs_long$year[as.numeric(state_legs_long$year)<90]), sep="")
state_legs_long$year[as.numeric(state_legs_long$year)>90]<-paste0("19",as.character(state_legs_long$year[as.numeric(state_legs_long$year)>90]), sep="")
state_legs_long<-state_legs_wide%>%
gather(party_house, members, dems_lhz90:vac_uhz14) %>%
separate(party_house, c("party_house", "year"), sep="z", extra = "merge")%>%
spread(party_house, members) %>%
arrange(state, year)
state_legs_long$year[as.numeric(state_legs_long$year)>90]<-paste0("19",as.character(state_legs_long$year[as.numeric(state_legs_long$year)>90]), sep="")
state_legs_long$year[as.numeric(state_legs_long$year)<90]<-paste0("20",as.character(state_legs_long$year[as.numeric(state_legs_long$year)<90]), sep="")
View(state_legs_long)
state_legs_long<-state_legs_wide%>%
gather(party_house, members, dems_lhz90:vac_uhz14) %>%
separate(party_house, c("party_house", "year"), sep="z", extra = "merge")%>%
spread(party_house, members) %>%
arrange(state, year)
state_legs_long$year[as.numeric(state_legs_long$year)>89]<-paste0("19",as.character(state_legs_long$year[as.numeric(state_legs_long$year)>89]), sep="")
state_legs_long$year[as.numeric(state_legs_long$year)<90]<-paste0("20",as.character(state_legs_long$year[as.numeric(state_legs_long$year)<90]), sep="")
state_legs_long[2:10]<-sapply(state_legs_long[2:10], as.numeric)
state_legs_long$lower_house[state_legs_long$dems_lh>state_legs_long$rep_lh]<-"D"
View(state_legs_long)
state_legs_long$upper_house[state_legs_long$dems_uh>state_legs_long$rep_uh]<-"D"
state_legs_long$upper_house[state_legs_long$dems_uh<state_legs_long$rep_uh]<-"R"
state_legs_long$legs_control[(state_legs_long$lower_house=="D"
& state_legs_long$upper_house=="D"]<-"D"
state_legs_long$legs_control[(state_legs_long$lower_house=="D"
& state_legs_long$upper_house=="D")]<-"D"
View(state_legs_long)
state_legs_long$legs_control[(state_legs_long$lower_house=="R"
& state_legs_long$upper_house=="R")]<-"R"
View(state_legs_long)
state_legs_long[2:10]<-sapply(state_legs_long[2:10], as.numeric)
state_legs_long$lower_house[state_legs_long$dems_lh>state_legs_long$rep_lh]<-"D"
state_legs_long$lower_house[state_legs_long$dems_lh<state_legs_long$rep_lh]<-"R"
state_legs_long$upper_house[state_legs_long$dems_uh>state_legs_long$rep_uh]<-"D"
state_legs_long$upper_house[state_legs_long$dems_uh<state_legs_long$rep_uh]<-"R"
state_legs_long$legs_control[(state_legs_long$lower_house=="D"
& state_legs_long$upper_house=="D")]<-"D"
state_legs_long$legs_control[(state_legs_long$lower_house=="R"
& state_legs_long$upper_house=="R")]<-"R"
View(state_legs_long)
state_legs_long$legs_control[(state_legs_long$legs_control!="R"
& state_legs_long$legs_control!="D")]<-"Split"
View(state_legs_long)
state_legs_long$lower_house[state_legs_long$dems_lh>state_legs_long$rep_lh]<-"D"
state_legs_long$lower_house[state_legs_long$dems_lh<state_legs_long$rep_lh]<-"R"
state_legs_long$lower_house[state_legs_long$dems_lh==state_legs_long$rep_lh]<-"Split"
state_legs_long$upper_house[state_legs_long$dems_uh>state_legs_long$rep_uh]<-"D"
state_legs_long$upper_house[state_legs_long$dems_uh<state_legs_long$rep_uh]<-"R"
state_legs_long$upper_house[state_legs_long$dems_uh==state_legs_long$rep_uh]<-"Split"
View(state_legs_long)
state_legs_long$legs_control[(state_legs_long$lower_house!=state_legs_long$upper_house)]<-"Split"
state_legs_long$legs_control[(state_legs_long$lower_house=="Split" | state_legs_long$upper_house=="Split")]<-"Split"
View(state_legs_long)
View(state_legs_long)
state_legs_long$rep_legs[state_legs_long$legs_control=="R"]<-1
state_legs_long$rep_legs[state_legs_long$legs_control!="R"]<-0
View(state_legs_long)
